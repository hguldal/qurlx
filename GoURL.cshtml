@{
    if (string.IsNullOrEmpty(Context.GetRouteValue("kod")))
     {
        Response.Write("Error !");
        Response.End();
        
     }
 
    var kod= Context.GetRouteValue("kod");
   
    var db=Database.Open("u2p");
    var queryUrl=db.QuerySingle("SELECT * FROM URL WHERE kisaKod=@0 OR uzunKod=@0",kod);
    
    db.Close();
    
    //url yok mu ? yoksa kategori olabilir mi ?
    if (queryUrl==null)
    {
       
       var queryKategori=db.QuerySingle("SELECT * FROM Kategori WHERE kisaKod=@0 OR uzunKod=@0",kod);
       
       if (queryKategori==null)
         {
             Response.Redirect("~/ErisimHatasi/AdresGecersiz");//sistemde bu kodlar kayıtlı bir url yada liste yok
         }
         else
         {
             //kategorinin sahibi oturum açmış kişi ise başka hiç bir koşula bakmaksızın direkt olarak adrese yönlendir.
             if (queryKategori.UserID==WebSecurity.CurrentUserId)
             {
                 db.Close();
                 Response.Redirect(queryKategori.url);
             }

            //belirlenen erişim süreleri belirlenmiş mi ve bu süreler içerisinde mi?
            if (string.IsNullOrEmpty(queryKategori.erisimBaslamaTarihi)==false && string.IsNullOrEmpty(queryKategori.erisimBitisTarihi)==false )      
              {
                  if (queryKategori.erisimBaslamaTarihi<DateTime.Now || queryKategori.erisimBitisTarihi>DateTime.Now )
                    {
                        Response.Redirect("~/ErisimHatasi/ErisimeKapali");
                    }
              }
         }
    
    }
    
    else
    {

        

        Response.Redirect(queryUrl.url);    
    }
    
    
}
