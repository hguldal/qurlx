@{
  if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  
        
     var db=Database.Open("u2p");  
     var kategoriAdi=Request["KategoriAdi"];
    var kisaKod="";
     using (db)
     {
       kisaKod=KodUret.YeniKod();
  
         while (db.QueryValue("SELECT COUNT(*) FROM KodCache WHERE kisaKod=@0",kisaKod)>0)
             {
                kisaKod=KodUret.YeniKod();
             }

         db.Execute("INSERT INTO Kategori(KategoriAdi,userID,kisaKod,olusturmaTarihi) VALUES (@0,@1,@2,@3)",kategoriAdi,WebSecurity.CurrentUserId,kisaKod,DateTime.Now);
         
     }
    var queryKategori=db.QuerySingle("SELECT * FROM Kategori WHERE kisaKod=@0",kisaKod);
     Json.Write(queryKategori, Response.Output);
     db.Close();   
     Response.ContentType = "application/json";
     Response.End();
    
}


