@{
  if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  
        
     var db=Database.Open("u2p");  
     var kategoriAdi=Request["KategoriAdi"];
      object eklenenKategoriID;
     using (db)
     {
         var kisaKod=KodUret.YeniKod();
  
         while (db.QueryValue("SELECT COUNT(*) FROM KodCache WHERE kisaKod=@0",kisaKod)>0)
             {
                kisaKod=KodUret.YeniKod();
             }

         db.Execute("INSERT INTO Kategori(KategoriAdi,userID,kisaKod) VALUES (@0,@1,@2)",kategoriAdi,WebSecurity.CurrentUserId,kisaKod);
         eklenenKategoriID=db.GetLastInsertId();
     }
    
     db.Close();
     Response.Write(eklenenKategoriID);
     Response.End();
}


