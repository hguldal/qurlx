@{
  
  if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  

     var db=Database.Open("u2p");
 
     var kisaKod=Request["KisaKod"];

     if (string.IsNullOrEmpty(kisaKod))
     {
         db.Close();   
         Response.StatusCode=500;
         Response.End();
     }
     
     using (db)
     {
       var queryUrl=db.QuerySingle("SELECT * FROM URL WHERE KisaKod=@0",kisaKod);
      
       if (queryUrl==null)
       {
         db.Close();   
         Response.StatusCode=500;
         Response.End();
       }
       
       db.Execute("DELETE FROM UrlKullanici WHERE urlID=@0 AND UserID=@1",queryUrl.urlID,WebSecurity.CurrentUserId);
       db.Execute("DELETE FROM UrlYonetici WHERE urlID=@0 AND UserID=@1",queryUrl.urlID,WebSecurity.CurrentUserId);
       var queryKategori=db.QuerySingle("SELECT * FROM URLKategori WHERE urlID=@0",queryUrl.urlID);
       
       if (queryKategori!=null)
       {
        db.Execute("DELETE FROM UrlKategori WHERE urlID=@0 AND kategoriID=@1",queryUrl.urlID,queryKategori.kategoriID);
       }

       Json.Write("OK", Response.Output);
       db.Close();   
       Response.ContentType = "application/json";
       Response.End();
    }

    
}
