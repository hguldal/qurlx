@{

if (!WebSecurity.IsAuthenticated)
   
    {
        Response.StatusCode = 401;
        Response.End();
                   
    }      

    var GrupID=Request["GrupID"];
    var UserID=Request["UserID"];
    var db=Database.Open("veritabani");

     //bu işlemi gerçekleştiren kullanıcı grubunu yöneticisi mi ?
    if (db.QueryValue("SELECT COUNT(*) FROM Grup_Yonetici WHERE GrupID=@0 AND UserID=@1 ",GrupID,WebSecurity.CurrentUserId)<1)
    {
        db.Close();
        Response.StatusCode = 401;
        Response.End();
    }

    db.Execute("INSERT INTO Grup_Uye(GrupID,UserID) VALUES(@0,@1)",GrupID,UserID);
    db.Execute("DELETE FROM Grup_UyeIstek WHERE GrupID=@0 AND UserID=@1",GrupID,UserID);
 
    db.Close();
    Response.StatusCode = 200;
    Response.End();        
}

